h1. Интранет и безопасность администратора

<p>&#8212; <em>Интранет и административные интерфейсы являются популярной целью для атак, поскольку они предоставляют привилегированный доступ. Хотя это и может потребовать несколько дополнительных мер безопасности, таковы реалии современного мира.</em></p>
<p>В 2007 году зарегистрирован первый специально изготовленный троян, похищающий информацию из Интранета, названный &#8220;Monster for employers&#8221; по имени вебсайта Monster.com, онлайн приложения по найму работников. Специально изготовленные трояны очень редки, поэтому риск достаточно низок, но, конечно, возможен, и пример показывает, что безопасность хоста клиента тоже важна. Однако, наибольшей угрозой для Интранета и администраторских приложений являются <span class="caps">XSS</span> и <span class="caps">CSRF</span>.</p>
<p><strong><span class="caps">XSS</span></strong>  Если ваше приложение повторно отображает введенные пользователем вредоносные данные, приложение уязвимо к <span class="caps">XSS</span>. Имена пользователей, комментарии, отчеты о спаме, адреса заказов это всего лишь обычные примеры, где может быть <span class="caps">XSS</span>.</p>
<p>Если есть всего лишь одно место в админке или Интранете, где ввод не был обработан, это делает целое приложение уязвимым. Возможными результатами могут быть похищение привилегированных администраторских куки, встраивание iframe для похищения администраторского пароля или установка злонамеренного программного обеспечения через дыры в безопасности браузера для установления контроля над компьютером администратора.</p>
<p>Обратитесь к разделу про инъекции для контрмер против <span class="caps">XSS</span>. Также <em class="highlight">Рекомендуется использовать плагин SafeErb</em> в Интранете или администраторском интерфейсе.</p>
<p><strong><span class="caps">CSRF</span></strong>  Подделка межсайтовых запросов (<span class="caps">CSRF</span>) это гигантский метод атаки, он позволяет злоумышленнику делать все то, что может делать администратор или пользователь Интранета. Так как мы уже раньше рассматривали, как работает <span class="caps">CSRF</span>, вот несколько примеров того, как злоумышленники могут обращаться с Интранетом или административным интерфейсом.</p>
<p>Реальным примером является <a href="http://www.h-online.com/security/Symantec-reports-first-active-attack-on-a-DSL-router--/news/102352">перенастройка роутера с помощью <span class="caps">CSRF</span></a>. Злоумышленники разослали зловредные электронные письма с вложенным <span class="caps">CSRF</span> мексиканским пользователям. Письма утверждали, что их ждет пластиковая карточка, но они также содержали тег изображения, который приводил к запросу <span class="caps">HTTP</span>-<span class="caps">GET</span> на перенастройку роутера пользователя (наиболее популярной модели в Мексике). Запрос изменял настройки <span class="caps">DNS</span> таким образом, что запросы к мексиканскому банковскому сайту направлялись на сайт злоумышленников. Все, кто обращался к банковскому сайту через роутер, видели фальшивый сайт злоумышленников, и у них были похищены полномочия.</p>
<p>Другой пример изменял адрес почты и пароль Google Adsense. Если жертва входила в Google Adsense, административный интерфейс рекламных компаний Google, злоумышленник изменял ее полномочия.</p>
<p>Другой популярной атакой является спам от вашего веб приложения, вашего блога или форума для распространения зловредного <span class="caps">XSS</span>. Конечно, злоумышленник должен знать структуру <span class="caps">URL</span>, но большинство URL Rails достаточно просты или они могут быть легко найдены, если это административный интерфейс приложения с открытым кодом. Злоумышленник даже может сделать 1,000 попыток, просто включив злонамеренный тег <span class="caps">IMG</span>, который пытается использовать каждую возможную комбинацию.</p>
<p>По <em class="highlight">контрмерам против <span class="caps">CSRF</span> в административных интерфейсах и приложениях Интранет, обратитесь к разделу по <span class="caps">CSRF</span></em>.</p>

<h4 id="additional-precautions">1. Дополнительные меры предосторожности</h4>
<p>Обычный административный интерфейс работает подобно этому: расположен в www.example.com/admin, может быть доступным только настроен признак администратора в модели  User, переотображает данные, введенные пользователем, и позволяет админу удалять/добавлять/редавтировать любую желаемую информацию. Вот некоторые мысли обо всем этом:</p>
<ul>
	<li>Очень важно <em class="highlight">думать о худшем случае</em>: Что если кто-то в самом деле достанет мои куки или полномочия пользователя. Вы должны <em class="highlight">ввести роли</em> для административного интерфейса, чтобы ограничить возможности злоумышленника. Или как насчет <em class="highlight">специальных полномочий авторизации</em> для административного интерфеса, отличающихся от тех, которые используются в публичной части приложения. Или <em class="highlight">специального пароля для очень серьезных действий</em>?</li>
</ul>
<ul>
	<li>Действительно ли админ должен иметь доступ к интерфейсу из любой точки мира? Подумайте насчет <em class="highlight">ограничения авторизации рядом IP адресов</em>. Проверьте request.remote_ip для того, чтобы узнать об IP адресах пользователя. Это не абсолютная, но серьезная защита. Хотя помните, что могут использоваться прокси.</li>
</ul>
<ul>
	<li><em class="highlight">Поместите административный интерфейс в специальный поддомен</em>, такой как admin.application.com, и сделайте его отдельным приложением со своим собственным управлением пользователями. Это сделает похищение админского куки из обычного домена www.application.com невозможным. Это происходит благодаря правилу ограничения домена вашего браузера: встроенный (<span class="caps">XSS</span>) скрипт на www.application.com не сможет прочитать куки для admin.application.com и наоборот.</li>
</ul>