h1. Получение электронной почты

<p>Получение и парсинг электронной почты с помощью Action Mailer может быть довольно сложным делом. До того, как электронная почта достигнет ваше приложение на Rails, нужно настроить вашу систему, чтобы каким-то образом направлять почту в приложение, которому нужно быть следящим за ней. Таким образом, чтобы получать электронную почту в приложении на Rails, нужно:</p>
<p>1. Реализовать метод <tt>receive</tt> в вашем рассыльщике.</p>
<p>2. Настроить ваш почтовый сервер для направления почты от адресов, желаемых к получению вашим приложением, в <tt>/path/to/app/script/rails runner 'UserMailer.receive(STDIN.read)'</tt>.</p>
<p>Как только метод, названный <tt>receive</tt>, определяется в каком-либо рассыльщике, Action Mailer будет парсить сырую входящую почту в объект email, декодировать его, создавать экземпляр нового рассыльщика и передавать объект email в метод экземпляра рассыльщика <tt>receive</tt>. Вот пример:</p>
<div class="code_container"><pre class="brush: ruby; gutter: false; toolbar: false">
class UserMailer &lt; ActionMailer::Base
  def receive(email)
    page = Page.find_by_address(email.to.first)
    page.emails.create(
      :subject =&gt; email.subject,
      :body =&gt; email.body
    )

    if email.has_attachments?
      for attachment in email.attachments
        page.attachments.create({
          :file =&gt; attachment,
          :description =&gt; email.subject
        })
      end
    end
  end
end
</pre></div>